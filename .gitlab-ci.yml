image: python:3.9-slim

stages:
    - test
    - deploy

before_script:
    - apt update -y
    # libgomp1 is not included in small Docker images, but needed for numpy
    - apt install -y libgomp1
    - pip install -e .

pytest:
  stage: test
  script:
  - pip install pytest
  - pytest --tb=short tests/
  artifacts:
    expire_in: 1 week
  only:
    changes:
      - eminus/*
      - eminus/**/*

pages:
  stage: deploy
  script:
    - pip install sphinx furo
    - sphinx-build -b html ./docs ./public
  artifacts:
    paths:
    - public
    expire_in: 1 week
  only:
    changes:
      - docs/*
      - docs/**/*
      - eminus/version.py
